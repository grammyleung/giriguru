@using Microsoft.AspNetCore.Builder
@using Microsoft.AspNetCore.Http.Features
@using Microsoft.AspNetCore.Localization
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Options
@using Microsoft.Extensions.Localization
@using GiriGuru.Web

@inject IViewLocalizer Localizer
@inject IStringLocalizer<SharedString> SharedStringLocalizer
@inject IOptions<RequestLocalizationOptions> LocOptions

@{
	ViewData["Title"] = Localizer["page-title"];

	bool isAddingNew = true;
	Guid guid = Guid.Empty;
	if (Context.Request.Query.TryGetValue("guid", out Microsoft.Extensions.Primitives.StringValues queryGuid))
	{
		if (Guid.TryParse(queryGuid, out guid))
		{
			if (guid != Guid.Empty)
			{
				isAddingNew = false;
			}
		}
	}

	if (isAddingNew)
	{
		ViewData["MenuActiveNewBlog"] = "active";
		guid = Guid.NewGuid();
	}
}

@section page_head
	{
	<link rel="stylesheet" href="~/lib-manual/editormd/css/editormd.css" />
	<link rel="stylesheet" href="~/lib/bootstrap-tagsinput/dist/bootstrap-tagsinput.css" />
}

<!-- Content Header (Page header) -->
<section class="content-header">
	<h1>
		@Localizer["content-header-title"]
		<small>@Localizer["content-header-caption"]</small>
	</h1>
	<ol class="breadcrumb">
		<li><a href="/"><i class="fa fa-home"></i> @SharedStringLocalizer["content-header-path-home"]</a></li>
		<li><a href="#"><i class="fa fa-book"></i> @SharedStringLocalizer["content-header-path-blog"]</a></li>
		<li class="active"><i class="fa fa-pencil-square-o"></i> @SharedStringLocalizer["content-header-path-blog-edit"]</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="row">
		<div class="col-md-12">
			<div class="box">
				<div class="box-header">
					<h3 class="box-title">
						正文內容編輯
						@if (isAddingNew)
						{
							<span>（新增）</span>
						}
					</h3>
				</div>
				<!-- /.box-header -->
				<div class="box-body no-border" style="z-index:99999;">
					<!-- text input -->
					<div class="form-group">
						<label>序列號</label>
						<input type="text" class="form-control" placeholder="" readonly name="formGuid" value="@guid.ToString()">
					</div>
					<div class="form-group">
						<label>標題</label>
						<input type="text" class="form-control" placeholder="" name="formTitle" value="">
					</div>
					<div class="form-group">
						<label>正文</label>
						<div id="formBody" name="formBody"></div>
					</div>
					<div class="form-group">
						<label>標籤</label>
						<div>
							<input type="text" id="tags" />
						</div>
					</div>
				</div>
				<!-- /.box-body -->
				<div class="box-footer">
					<button type="button" class="btn btn-default pull-right" onclick="javascript: document.location.href = '@Context.Request.Path' + '?u=00000000-0000-0000-0000-000000000000';">新增管理员</button>
				</div>
				<!-- /.box-footer -->
			</div>
			<!-- /.box -->
		</div>
		<!-- /.col -->
	</div>
	<!-- /.row -->

	<div class="box-body">
	</div>

</section>


@section page_foot
	{
	<script src="~/lib-manual/editormd/examples/js/jquery.min.js"></script>
	<script src="~/lib-manual/editormd/editormd.min.js"></script>
	<script src="~/lib/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"></script>
	<script type="text/javascript">
		var testEditor;

		$(function () {
			testEditor = editormd("formBody", {
				width: "100%",
				height: 640,
				syncScrolling: "single",
				path: "/lib-manual/editormd/lib/",
				//theme: "dark",
				//previewTheme: "dark",
				//editorTheme: "pastel-on-dark",
				//markdown: md,						/* Crashes after adding this option line, need to find reason. */
				codeFold: true,
				//syncScrolling : false,
				saveHTMLToTextarea: true,    // 保存 HTML 到 Textarea
				searchReplace: true,
				//watch : false,                // 关闭实时预览
				//htmlDecode: "style,script,iframe|on*",            // 开启 HTML 标签解析，为了安全性，默认不开启
				//toolbar  : false,             //关闭工具栏
				//previewCodeHighlight : false, // 关闭预览 HTML 的代码块高亮，默认开启
				emoji: true,
				taskList: true,
				tocm: true,         // Using [TOCM]
				tex: true,                   // 开启科学公式TeX语言支持，默认关闭
				flowChart: true,             // 开启流程图支持，默认关闭
				sequenceDiagram: true,       // 开启时序/序列图支持，默认关闭,
				//dialogLockScreen : false,   // 设置弹出层对话框不锁屏，全局通用，默认为true
				//dialogShowMask : false,     // 设置弹出层对话框显示透明遮罩层，全局通用，默认为true
				//dialogDraggable : false,    // 设置弹出层对话框不可拖动，全局通用，默认为true
				//dialogMaskOpacity : 0.4,    // 设置透明遮罩层的透明度，全局通用，默认值为0.1
				//dialogMaskBgColor : "#000", // 设置透明遮罩层的背景颜色，全局通用，默认为#fff
				imageUpload: true,
				imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
				imageUploadURL: "/Blog/UploadImage?guid=@guid.ToString()",
				onfullscreen: function () {
					//alert("onfullscreen");
					$(".main-header").hide();
					$(".main-sidebar").hide();
					// console.log("onfullscreen =>", this, this.id, this.settings);
				},
				onfullscreenExit: function () {
					//alert("onfullscreenExit");
					$(".main-header").show();
					$(".main-sidebar").show();
					// console.log("onfullscreenExit =>", this, this.id, this.settings);
				}
			});

			/*
			testEditor = editormd("test-editormd", {
				width: "90%",
				height: 740,
				path: '../lib/',
				theme: "dark",
				previewTheme: "dark",
				editorTheme: "pastel-on-dark",
				markdown: md,
				codeFold: true,
				//syncScrolling : false,
				saveHTMLToTextarea: true,    // 保存 HTML 到 Textarea
				searchReplace: true,
				//watch : false,                // 关闭实时预览
				htmlDecode: "style,script,iframe|on*",            // 开启 HTML 标签解析，为了安全性，默认不开启
				//toolbar  : false,             //关闭工具栏
				//previewCodeHighlight : false, // 关闭预览 HTML 的代码块高亮，默认开启
				emoji: true,
				taskList: true,
				tocm: true,         // Using [TOCM]
				tex: true,                   // 开启科学公式TeX语言支持，默认关闭
				flowChart: true,             // 开启流程图支持，默认关闭
				sequenceDiagram: true,       // 开启时序/序列图支持，默认关闭,
				//dialogLockScreen : false,   // 设置弹出层对话框不锁屏，全局通用，默认为true
				//dialogShowMask : false,     // 设置弹出层对话框显示透明遮罩层，全局通用，默认为true
				//dialogDraggable : false,    // 设置弹出层对话框不可拖动，全局通用，默认为true
				//dialogMaskOpacity : 0.4,    // 设置透明遮罩层的透明度，全局通用，默认值为0.1
				//dialogMaskBgColor : "#000", // 设置透明遮罩层的背景颜色，全局通用，默认为#fff
				imageUpload: true,
				imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
				imageUploadURL: "./php/upload.php",
				onload: function () {
					console.log('onload', this);
					//this.fullscreen();
					//this.unwatch();
					//this.watch().fullscreen();

					//this.setMarkdown("#PHP");
					//this.width("100%");
					//this.height(480);
					//this.resize("100%", 640);
				}
			});
			*/
			/*
			// or
			testEditor = editormd({
				id      : "test-editormd",
				width   : "90%",
				height  : 640,
				path    : "../lib/"
			});
			*/
		});
	</script>
	<script>
		var elt = $('#tags');
		elt.tagsinput({
			tagClass: 'label label-primary tag-text',
			itemValue: 'Guid',
			itemText: 'Text'
		});
		elt.tagsinput('add', { "Guid": 1, "Text": "阿姆斯特丹" });
		elt.tagsinput('add', { "Guid": 4, "Text": "華盛頓" });
		elt.tagsinput('add', { "Guid": 7, "Text": "悉尼" });
		elt.tagsinput('add', { "Guid": 10, "Text": "上海" });
		elt.tagsinput('add', { "Guid": 13, "Text": "開羅" });
	</script>
}